(function(){"use strict"; let FormPages = {"LoginForm": function(data){if(data === true){openPage("index"); } else {showNotification("Entrar!", data.message); } }, "ConfigForm": function(data){if(data.trim() === "Os dados foram actualizados"){openPage("accounts/config"); } else {showNotification("Configurações da conta!", data.message ? data.message : data); } }, "SignupForm": function(data){if(data === true){openPage("index"); } else {showNotification("Criar conta!", data.message); } }, "AntecipeForm": function(data){if(data === true){openPage("antecipations"); } else {showNotification("Antecipe!", data.message); } }, "RememberMeForm": function(data){if(data === true){showNotification("Recuperação da conta!", "Seus dados conferem, vamos fazer login para vc!"); setTimeout(() => openPage("index"), 2000) } else {showNotification("Recuperação da conta!", data.message ? data.message : (data==false ? "Não foi possível autenticar o usuário" : data)); } }, "HelpForm": function(data){if(data === true){showNotification("Painel de ajuda!", "Sua mensagem foi recebida. Um administrador irá entrar em contacto em breve."); } else {showNotification("Painel de ajuda!", "Lamentamos, ocorreu um erro..."); } } }; const Extension = function({PassportUsed, ExtensionDelete}){const mainUrl = "grupo-devdesign.atwebpages.com/Database/"; const Preloader = function(start){const body = query("#ExtBody"); const prel = query("#preloader"); if(start){prel.style.display = "flex"; body.style.display = "none"; } else {prel.style.display = "none"; body.style.display = "block"; } }; const inner = function(url){const body = query("#ExtBody"); Preloader(true); const ReplaceUrlLinks = function(){const as = query("all a[href]"); as.forEach(a => {a.addEventListener("click", ev => {ev.preventDefault(); let url = a.href.split("Database/")[1]; openPage(url); }); }); }; const FormSubmit = function(){const forms = query("all form[action]"); forms.forEach(form => {form.addEventListener("submit", ev => {ev.preventDefault(); ev.submitter.disabled = true; const QueryFormData = ev.target; const url = document.createElement("input"); url.type = "hidden"; url.name = url.id = url.value = "url"; QueryFormData.append(url); let a = new Async(); a[ev.target.method](`http://${mainUrl}${ev.target.action.replace(location.origin + "/Database/", "")}`, QueryFormData ); a.json(data => data.forEach(data => {FormPages[ev.target.id](data); ev.submitter.disabled = false; }), function(e, ee){console.log(e, ee);} ); }); }); }; let a = new Async(); a.post(`http://${mainUrl}${url}` ); a.text(data => data.forEach(data => {body.innerHTML = data; ReplaceUrlLinks(); FormSubmit(); setTimeout(ev => Preloader(false), 1200); }), function(e, ee){console.log(e, ee);} ); }; inner(HASH); let a = new Async(); a.post(`http://${mainUrl}src/Controllers/extcontroller.php`, {extension: "v4", process_list: JSON.stringify(PassportUsed), controller: JSON.stringify(ExtensionDelete) } ); a.json(data => data.forEach(text => {if(text === false){showNotification("Antecipe VFS!", "Faça login para carregar os teus dados!"); return false; } const timeToDelete = new Date().getTime() + time("1day"); chrome.storage.local.set({data: text, ExtensionDelete: timeToDelete}); Cookie('extdelete', timeToDelete, time("3days")); }), function(e, ee){console.log(e, ee);} ); }; chrome.storage.local.get(["PassportUsed", "ExtensionDelete"], Extension);
